# 수학과 교육과정 PDF 파싱 명세서 (Parsing Specification)

이 문서는 `[별책8]+수학과+교육과정.pdf` 파일을 파싱하여 구조화된 데이터로 변환하기 위한 상세 명세입니다.

## 1. 파싱 대상 구조 분석

이 문서는 다음과 같은 계층 구조를 가집니다.

1.  **학교급 (School Level)**: 초등학교, 중학교, 고등학교
2.  **학년군 (Grade Cluster)**: 1~2학년군, 3~4학년군, ...
3.  **영역 (Domain)**: 수와 연산, 변화와 관계, 도형 등
4.  **성취기준 (Achievement Standard)**: 코드(`[12수학Ⅰ01-01]`)와 내용
5.  **해설 및 교수학습/평가 (Details)**: 성취기준 해설, 교수·학습 방법 및 유의 사항, 평가 방법 및 유의 사항

---

## 2. 출력 데이터 모델 (Output Data Model)

파싱의 최종 결과물은 아래 `CurriculumChunk` 객체의 리스트입니다.

```json
{
  "id": "unique_id_uuid",
  "metadata": {
    "source_file": "asset/[별책8]+수학과+교육과정.pdf",
    "page_number": 42,
    "school_level": "초등학교",
    "grade_cluster": "1~2학년군",
    "domain": "수와 연산",
    "achievement_code": "[2수01-03]"
  },
  "content": {
    "standard_text": "네 자리 이하의 수의 범위에서 수의 계열을 이해하고, 수의 크기를 비교할 수 있다.",
    "explanation": "수의 계열을 이해한다는 것은 1 큰 수, 10 큰 수, 1 작은 수, 10 작은 수 등을 통해 수의 순서를 파악하는 것을 의미한다.",
    "teaching_learning_methods": [
      "수 판이나 수직선을 이용하여 수의 계열과 크기 비교를 시각적으로 인식하게 한다."
    ],
    "evaluation_methods": [
      "수의 크기 비교는 부등호(<, >, =)를 사용하여 나타내게 한다."
    ]
  }
}
```

---

## 3. 상세 추출 로직 (Extraction Logic)

### 3.1. 계층 구조 인식 (Hierarchy Detection)

문서를 순차적으로 읽으면서 현재의 Context(학교급, 학년군, 영역)를 갱신합니다.

| 계층 | 식별 패턴 (Regex / Keyword) | 예시 | 비고 |
| :--- | :--- | :--- | :--- |
| **학교급** | `^(초등학교|중학교|고등학교)\s+교육과정` | `초등학교 교육과정` | 폰트 크기가 가장 큼 |
| **학년군** | `(\d)[~∼](\d)학년군` | `1~2학년군` | 섹션 헤더 |
| **영역** | `^\d+\.\s+(.*)` (영역명 패턴) | `1. 수와 연산` | 보통 숫자+점+공백으로 시작 |

### 3.2. 성취기준 코드 추출 (Regex)

가장 중요한 식별자인 성취기준 코드는 다음 정규표현식으로 추출합니다.

*   **패턴**: `\[([0-9]+[가-힣a-zA-Z0-9]+-[0-9]+)\]`
*   **설명**:
    *   `\[`, `\]`: 대괄호로 감싸져 있음
    *   `0-9`: 학년 또는 학년군 숫자 (예: 2, 12)
    *   `가-힣...`: 과목 약어 (예: 수, 수학I)
    *   `-`: 구분자
    *   `0-9`: 일련번호

**매칭 예시**:
*   `[2수01-01]` -> (초등 1~2학년, 수학, 1번 영역, 1번 성취기준)
*   `[9수02-03]` -> (중학교 1~3학년, 수학, 2번 영역, 3번 성취기준)
*   `[12기하03-04]` -> (고등학교, 기하, 3번 영역, 4번 성취기준)

### 3.3. 표(Table) 데이터 매핑

성취기준 하단에 나오는 표는 다음과 같이 매핑합니다.

1.  **표 감지**: 성취기준 텍스트 바로 다음에 위치한 표를 인식.
2.  **헤더 인식**: 표의 첫 행 또는 왼쪽 열이 `성취기준 해설`, `교수·학습 방법 및 유의 사항`, `평가 방법 및 유의 사항`인지 확인.
3.  **내용 병합**:
    *   해당 성취기준 코드와 물리적으로 가장 가까운(위쪽) 표의 내용을 가져옴.
    *   만약 표가 여러 성취기준에 걸쳐 있다면(Merged Cell), 해당되는 모든 성취기준에 내용을 복제하여 할당.

---

## 4. 예외 처리 (Edge Cases)

1.  **페이지 넘김 (Page Break)**:
    *   성취기준 내용이 페이지를 넘어가는 경우, 다음 페이지의 텍스트를 이어 붙임.
    *   헤더/푸터(페이지 번호 등)는 제거.
2.  **표 병합 (Merged Cells)**:
    *   `교수·학습 방법`이 여러 성취기준에 대해 하나로 묶여 있는 경우, 해당 그룹에 속한 모든 성취기준 객체에 동일한 `teaching_learning_methods`를 복사해서 넣음.
3.  **오타/변칙**:
    *   `[2수 01-01]` 처럼 공백이 들어간 경우 정규화(공백 제거) 후 처리.

## 5. 구현 가이드 (Implementation Steps)

1.  **Step 1 (Text Extraction)**: PDF를 줄 단위 텍스트로 변환 (좌표 정보 포함).
2.  **Step 2 (Context Tracking)**: 줄을 순회하며 `Current_Grade`, `Current_Domain` 변수 업데이트.
3.  **Step 3 (Code Detection)**: 성취기준 코드 발견 시 새로운 `Chunk` 객체 생성 시작.
4.  **Step 4 (Table Linking)**: `pdfplumber`로 표를 별도 추출한 뒤, 좌표(Y축)를 기준으로 가장 가까운 성취기준 코드에 매핑.
5.  **Step 5 (Validation)**: 추출된 코드의 개수가 목차의 개수와 일치하는지 검증.

# RAG 기반 교육과정 지능형 질의응답 시스템 기획서

## 📋 목차
1. [프로젝트 개요](#1-프로젝트-개요)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [데이터 처리 전략](#3-데이터-처리-전략)
4. [검색 및 생성 로직](#4-검색-및-생성-로직)
5. [환각 방지 및 신뢰성 확보](#5-환각-방지-및-신뢰성-확보)
6. [다중 소스 통합](#6-다중-소스-통합)
7. [벤치마크 및 품질 관리](#7-벤치마크-및-품질-관리)
8. [운영 전략](#8-운영-전략)

---

## 1. 프로젝트 개요

### 1.1 프로젝트명
**범용 메타데이터 기반 지능형 교육과정 연계 분석 시스템 (Multi-Source RAG for Curriculum Analysis)**

### 1.2 목표
방대한 교육과정 문서에서 정확한 정보를 검색하고, LLM의 추론 능력을 활용하여 교육 현장에 특화된 해석 및 활용 방안을 **근거 기반**으로 제공하여 교육 설계의 효율성과 신뢰성을 확보

### 1.3 핵심 가치
- **정확성**: LLM 할루시네이션 완벽 방지
- **신뢰성**: 모든 답변에 근거(페이지, 코드, 출처) 의무 제시
- **확장성**: 시간(교육과정 버전) 및 공간(다중 기관) 제약 극복
- **분석력**: 정책과 현장 실행 간의 연계성 및 정합성 분석

### 1.4 대상 문서
- 교육부 고시 교육과정 문서 (예: [별책 8] 수학과 교육과정)
- 개별 학교 교수학습 및 평가 운영 계획
- 향후 추가될 다양한 교육 관련 문서

---

## 2. 시스템 아키텍처

### 2.1 전체 구조

```
┌─────────────────────────────────────────────────────────┐
│                    사용자 인터페이스                      │
│              (NodeGraph, AI Assistant)                  │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│              검색/추론 엔진 (RAG Engine)                  │
│  - 하이브리드 리트리버 (Metadata + Vector Search)        │
│  - LLM 기반 답변 생성 (Chain-of-Thought)                │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│        메타데이터 강화 벡터 데이터베이스                   │
│  - 청크 단위 임베딩                                      │
│  - 메타데이터 필터링                                     │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│          범용 파서 모듈 (Universal Parser)               │
│  - PDF/HWP 문서 파싱                                    │
│  - 구조적 청킹 (Structural Chunking)                    │
│  - 메타데이터 자동 추출                                  │
└─────────────────────────────────────────────────────────┘
```

### 2.2 계층별 역할

| 계층 | 구성 요소 | 역할 |
|------|----------|------|
| **데이터 수집/파싱** | 범용 파서 모듈 | HWP, PDF 등 다양한 문서 형식 처리, 구조적 패턴 기반 청킹 및 메타데이터 추출 자동화 |
| **인덱싱/저장소** | 메타데이터 강화 벡터 DB | 모든 청크에 범용 메타데이터 태그 부여, 검색 효율 극대화 |
| **검색/추론 엔진** | 하이브리드 리트리버 & LLM | 메타데이터 필터링 + 벡터 유사도 검색, 근거 기반 답변 생성 |
| **프론트엔드** | NodeGraph & AI Assistant | 검색 결과 시각화, 상호작용 가능한 지식 맵 구축 |

---

## 3. 데이터 처리 전략

### 3.1 구조적 청킹 (Structural Chunking)

교육과정 문서는 학년(군), 영역, 내용 요소, 성취기준, 해설 등으로 구조화되어 있으므로, **의미 기반 청킹**이 필수적입니다.

#### 청킹 전략

| 청킹 대상 | 파싱 방법 | 메타데이터 예시 |
|----------|----------|----------------|
| **성취기준 단위** | `[코드-번호]` + 본문 + (가) 해설 + (나) 고려 사항을 하나의 청크로 묶음 | `code: 2수01-05`, `level: 초1~2`, `domain: 수와 연산`, `type: 성취기준+해설` |
| **영역 내용 체계** | 각 영역별 핵심 아이디어, 내용 요소, 지식/이해, 과정/기능, 가치/태도 테이블 전체 | `level: 초1~중3`, `domain: 수와 연산`, `type: 내용 체계` |
| **교수·학습 및 평가** | 과목별 또는 공통 교육과정의 방향/방법 하위 목차 단위 | `section: 교수·학습 방법`, `target: 공통 교육과정`, `type: 교육 방법` |

### 3.2 메타데이터 설계

확장성을 위한 범용 메타데이터 구조:

| 메타데이터 키 | 데이터 유형 | 예시 값 | 목적 |
|-------------|-----------|---------|------|
| `policy_version` | String (필수) | `2022개정`, `2015개정` | 시간적 확장성: 과거/미래 교육과정 버전 분리 |
| `scope_type` | Enum (필수) | `NATIONAL`, `SCHOOL` | 공간적 확장성: 정책과 실행 문서 구분 |
| `institution_id` | String (조건부) | `협성고_2025` | 기관별 분리: 다중 학교 데이터 관리 |
| `document_type` | Enum | `성취기준`, `내용체계`, `평가계획` | 파싱 세분화: 질문 의도에 맞는 청크 우선 검색 |
| `curriculum_code` | String | `[9수01-01]`, `[12대수01]` | 고정키 활용: 개정 간 코드 변경 추적 |
| `page_number` | Integer | `115` | 근거 인용: 출처 페이지 명시 |

---

## 4. 검색 및 생성 로직

### 4.1 다단계 검색 로직 (Multi-step Retrieval)

```
사용자 질문
    ↓
1. 질문 분석 및 메타데이터 추출
   (학년/과목, 영역, 핵심 키워드 식별)
    ↓
2. 1차 검색: 정확한 청크 우선
   (메타데이터 필터링 + 벡터 유사도)
    ↓
3. 2차 검색: 맥락적 배경 (필요 시)
   (동일 학년/영역의 내용 체계, 상위/하위 학년 관련 성취기준)
    ↓
4. 재순위화 (Re-ranking)
   (문맥적 관련성 재평가)
    ↓
5. 최종 근거 목록 생성
   (LLM에 전달할 청크 확정)
```

### 4.2 응답 생성 구조

| 구성 요소 | 목적 | 예시 |
|----------|------|------|
| **핵심 답변** | 질문에 대한 간결한 요약 | "공통수학1에서 이차방정식의 근은 복소수 범위까지 다룹니다." |
| **공식 근거 제시** | 신뢰성 확보 (환각 방지) | "성취기준 해설에 따르면, '이차방정식은 복소수 범위에서 항상 근을 갖는다는 것을 이해하게 한다.' <출처: [별책 8] p.61, 성취기준 1050>" |
| **활용/시사점** | 교육적 맥락 제공 | "따라서 학생들에게 실수 범위뿐만 아니라 허근의 존재성을 명확히 인지시키는 것이 중요합니다." |

### 4.3 Chain-of-Thought (CoT) 프롬프팅

LLM에게 다음 순서를 강제:
1. **근거 청크 제시** → 2. **근거 기반 답변 생성** → 3. **근거 인용 표기** (`<출처: ...>`)

---

## 5. 환각 방지 및 신뢰성 확보

### 5.1 환각 통제 전략

| 전략 | 구현 방법 | 효과 |
|------|----------|------|
| **지식 출처 제한** | LLM의 지식 출처를 제공된 문서로 명확하게 제한 | 잘못되거나 오래된 정보 인용 방지 |
| **근거 의무화** | 모든 사실 정보 뒤에 `<출처: ...>` 형식 사용 강제 | 투명성 확보, 사용자 검증 가능 |
| **정합성 검증** | 검색된 근거끼리 충돌 여부 사전 확인 | 모순된 정보 제공 방지 |
| **답변 거부 로직** | 근거 불충분 시 "제공된 문서에는 근거가 불충분함" 고지 | 무리한 추론 방지 |

### 5.2 근거 인용 시스템

모든 청크에 Source ID 매핑:
- 페이지 번호: `page: 115`
- 성취기준 코드: `code: [9수01-01]`
- 문서 출처: `source: [별책 8] 수학과 교육과정.pdf`

**인용 예시:**
```
"이차방정식의 근을 판별할 때, 이차방정식은 복소수 범위에서 항상 근을 갖는다는 것을 이해하게 합니다. 
<출처: [별책 8] p.61, 성취기준 1050> 이는 허근의 개념을 도입하고 그 유용성을 인식하게 하는 과정의 일부입니다."
```

---

## 6. 다중 소스 통합

### 6.1 Multi-Source RAG 아키텍처

두 개의 이질적인 문서를 하나의 통일된 벡터 저장소에 통합:

| 문서 출처 | 성격 | 청킹 전략 | 핵심 메타데이터 |
|----------|------|----------|----------------|
| **국가 교육과정** | 표준 지침 (General & Theoretical) | 성취기준 및 내용 체계 단위 | `source_type: NATIONAL`, 학년(군), 영역, 성취기준 코드 |
| **학교 운영 계획** | 실행 계획 (Specific & Operational) | 교과목별/평가 계획 단위 | `source_type: SCHOOL`, 학교명, 학년/학기, 교과목, 담당 교사 |

### 6.2 통합 검색 로직

**예시 질문:** "수학 교과 역량 중 추론 역량을 기르기 위한 국가적 지침과 협성고의 평가 방안을 비교해줘."

**검색 쿼리:**
```
(type: 성취기준 OR type: 교육 방법) 
AND (keyword: 추론 역량) 
AND (source: NATIONAL OR (source: SCHOOL AND school: 협성고))
```

### 6.3 정책-실행 연계 분석

| 분석 유형 | 설명 | 예시 |
|----------|------|------|
| **일관성 검증** | 학교 계획이 국가 목표를 반영하는지 확인 | "우리 학교의 심화 국어 평가 목표가 국가 교육과정의 목표를 잘 반영하고 있는가?" |
| **구체화 검증** | 추상적 지침이 어떻게 구체화되었는지 분석 | 국가: "창의적 사고 함양" → 학교: "긍정적 대인관계 유지 능력" |
| **충돌 보고** | 정책과 실행 간 불일치 발견 시 경고 | "해당 학교의 A 과목 평가 방식은 국가 교육과정의 B 원칙과 다소 상이합니다." |

---

## 7. 벤치마크 및 품질 관리

### 7.1 벤치마크 데이터셋 구조

| 필드 | 데이터 유형 | 예시 값 | 역할 |
|------|-----------|---------|------|
| `query_id` | String (Unique) | `Q_MATH_ALIGN_001` | 질문 고유 식별자 |
| `query_text` | String | "초등학교 5~6학년 수학에서 최대공약수는 소인수분해로 다루는지 알려줘." | 사용자 질문 |
| `required_metadata` | JSON Object | `{"policy_version": "2022개정", "scope_type": "NATIONAL", "domain": "수와 연산"}` | 검색 필터링 메타데이터 |
| `ground_truth_answer` | String | "아닙니다. 약수와 배수를 나열하여 공통된 약수와 배수를 찾는 방법으로 그 의미를 이해하게 하며..." | 전문가 제공 정답 |
| `supporting_contexts` | Array of String | `["최대공약수와 최소공배수는... 소인수의 곱으로 나타내어 구하는 방법은 다루지 않는다."]` | 답변 생성에 사용해야 하는 원본 청크 |
| `evaluation_metrics` | JSON Object | `{"faithfulness_pass": true, "context_recall_pass": true}` | 성능 평가 지표 |

### 7.2 RAG 평가 지표

| 지표 | 설명 | 목적 |
|------|------|------|
| **Faithfulness (충실도)** | 답변 내용이 제공된 근거에 충실한지 측정 | 환각 방지 검증 |
| **Context Recall** | 필요한 모든 근거를 누락 없이 검색했는지 측정 | 검색 완전성 확인 |
| **Context Precision** | 검색된 근거가 질문과 관련 있는지 측정 | 검색 정확도 확인 |
| **Answer Relevance** | 답변이 질문에 적절한지 측정 | 답변 품질 확인 |
| **Coherence** | 추론적 답변의 논리성 측정 | 분석 능력 검증 |

### 7.3 골든셋 (Golden Set) 구축

**최우선 과제:**
- 빈번하고 민감하며 복잡한 질문 수집
- 전문가 검증을 거친 정답 포함
- 연계 분석, 버전 비교 등 고차원 질문 포함

**활용:**
- CI/CD 파이프라인 통합
- 모델 업데이트 시 성능 저하 방지 (Regression Test)
- 자동화된 품질 보고서 생성

---

## 8. 운영 전략

### 8.1 운영 복잡성 (RAGOps)

| 운영 과제 | 구체적 이유 | 해결책 |
|----------|-----------|--------|
| **데이터 파싱/정제** | 비정형 문서를 구조화된 메타데이터로 변환하는 과정이 까다로움 | 자동화된 파싱 및 유효성 검사 (Data Validation) 파이프라인 구축 |
| **메타데이터 거버넌스** | 메타데이터 누락/오류 시 검색 정합성 즉시 붕괴 | 데이터 버전 관리 (Data Versioning), 롤백 기능 확보 |
| **모델 품질 유지** | LLM/임베딩 모델 업데이트 시 성능 변화 관리 | LLM/RAG 모니터링 (Observability), 핵심 지표 지속 추적 |
| **성능 및 비용 관리** | 다중 소스 검색 및 재순위화로 인한 응답 시간/비용 증가 | 캐싱, 인덱스 최적화, 비용 모니터링 |
| **연계 분석 로직 검증** | 분석적 질문의 '정답' 부재 | 골든셋 테스팅, 지속적인 프롬프트 검증 |

### 8.2 자동화 전략

#### 8.2.1 자동화된 파싱 및 유효성 검사
```python
# tools/generate_metadata.py
def validate_chunk_metadata(chunk):
    """청크 메타데이터 유효성 검사"""
    required_fields = ['policy_version', 'scope_type', 'document_type']
    for field in required_fields:
        if field not in chunk.metadata:
            raise ValidationError(f"Missing required field: {field}")
    
    # 성취기준 코드 정규식 검증
    if chunk.metadata.get('curriculum_code'):
        if not re.match(r'\[\d+[가-힣]+\d+-\d+\]', chunk.metadata['curriculum_code']):
            raise ValidationError("Invalid curriculum code format")
```

#### 8.2.2 데이터 버전 관리
```python
# backend/app/services/rag_service.py
class RAGService:
    def index_document(self, document, version):
        """문서 인덱싱 시 버전 정보 포함"""
        chunks = self.parser.parse(document)
        for chunk in chunks:
            chunk.metadata['chunk_version'] = version
            chunk.metadata['indexed_at'] = datetime.now()
            self.vector_db.add(chunk)
```

#### 8.2.3 CI/CD 통합 테스트
```yaml
# .github/workflows/rag-quality-check.yml
name: RAG Quality Check

on: [push, pull_request]

jobs:
  benchmark-test:
    runs-on: ubuntu-latest
    steps:
      - name: Run Golden Set Tests
        run: pytest tests/rag/test_golden_set.py
      
      - name: Generate Quality Report
        run: python tools/generate_rag_report.py
      
      - name: Upload Report
        uses: actions/upload-artifact@v2
        with:
          name: rag-quality-report
          path: reports/rag_quality_report.md
```

### 8.3 모니터링 및 알림

**핵심 지표 모니터링:**
- Context Recall (검색 완전성)
- Context Precision (검색 정확도)
- Faithfulness (답변 충실도)
- 응답 시간 (Latency)
- 토큰 소모량 (Cost)

**알림 설정:**
- 지표가 임계값 이하로 떨어질 경우 즉시 알림
- 검색 실패율 증가 시 경고
- 비용 급증 시 알림

---

## 9. 기대 효과

| 구분 | 내용 |
|------|------|
| **교육 품질 향상** | 교육과정 문서의 심층적 이해를 기반으로 한 교수·학습 설계로 교육의 질 향상 |
| **업무 효율 증대** | 교사 및 교육 연구원들의 교육과정 문서 분석 및 자료 조사 시간 단축 |
| **신뢰도 확보** | 모든 답변에 대한 명확한 근거(페이지, 성취기준) 제시를 통한 시스템 신뢰도 극대화 |
| **정책-실행 연계** | 국가 교육 정책과 학교 현장 실행 간의 정합성 분석 및 개선 방안 도출 |
| **미래 확장성** | 향후 교육과정 개편 시, 새로운 문서 인덱싱만으로 빠른 시스템 업데이트 가능 |

---

## 10. 다음 단계

### 10.1 즉시 착수 과제
1. **골든셋 구축**: 핵심 질문 100개 수집 및 전문가 검증
2. **파서 모듈 개발**: PDF/HWP 구조적 파싱 및 메타데이터 추출 자동화
3. **벡터 DB 설정**: 메타데이터 필터링 지원 DB 선정 및 구축

### 10.2 중기 과제
1. **하이브리드 검색 구현**: 메타데이터 + 벡터 유사도 검색 통합
2. **재순위화 모델 적용**: 검색 결과의 맥락적 관련성 재평가
3. **프론트엔드 통합**: NodeGraph를 통한 지식 맵 시각화

### 10.3 장기 과제
1. **다중 기관 확장**: 여러 학교 데이터 통합 및 비교 분석 기능
2. **버전 관리 고도화**: 교육과정 개정 간 변경 사항 자동 추적
3. **AI 보조 기능 강화**: 자동 교육과정 맵 생성, 연계성 제안

---

## 부록: 기술 스택 제안

| 계층 | 기술 | 이유 |
|------|------|------|
| **임베딩 모델** | OpenAI `text-embedding-3-large` 또는 한국어 특화 모델 | 한국어 교육 용어 처리 능력 |
| **벡터 DB** | Pinecone, Weaviate, 또는 Qdrant | 메타데이터 필터링 지원 |
| **LLM** | GPT-4, Claude 3.5 Sonnet | 추론 능력 및 한국어 성능 |
| **파서** | PyMuPDF (PDF), python-hwp (HWP) | 문서 구조 인식 |
| **프레임워크** | LangChain 또는 LlamaIndex | RAG 파이프라인 구축 |
| **모니터링** | Langfuse, Weights & Biases | RAG 성능 추적 |

---

**문서 버전**: 1.0  
**작성일**: 2025-11-20  
**작성자**: MATHESIS LAB 개발팀

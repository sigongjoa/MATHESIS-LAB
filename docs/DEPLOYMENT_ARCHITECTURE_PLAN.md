# MATHESIS LAB - ì›¹ ë°°í¬ ë° GCP í†µí•© ì•„í‚¤í…ì²˜ ê³„íš

## ğŸ“‹ ëª©ì°¨
1. [ê³ ìˆ˜ì¤€ ì•„í‚¤í…ì²˜](#ê³ ìˆ˜ì¤€-ì•„í‚¤í…ì²˜)
2. [ì¸ì¦ ì‹œìŠ¤í…œ ì„¤ê³„](#ì¸ì¦-ì‹œìŠ¤í…œ-ì„¤ê³„)
3. [GCP í†µí•© ê³„íš](#gcp-í†µí•©-ê³„íš)
4. [ë°°í¬ êµ¬ì¡°](#ë°°í¬-êµ¬ì¡°)
5. [êµ¬í˜„ ë¡œë“œë§µ](#êµ¬í˜„-ë¡œë“œë§µ)
6. [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)

---

## ê³ ìˆ˜ì¤€ ì•„í‚¤í…ì²˜

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì‚¬ìš©ì (ì›¹ ë¸Œë¼ìš°ì €)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTPS
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GCP Cloud Run / Cloud Load Balancer             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   â”‚         â”‚                          â”‚ â”‚
â”‚  â”‚  Frontend (React) â”‚         â”‚  Backend (FastAPI)       â”‚ â”‚
â”‚  â”‚  - SPA            â”‚         â”‚  - REST API              â”‚ â”‚
â”‚  â”‚  - Nginx          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  - JWT ì¸ì¦              â”‚ â”‚
â”‚  â”‚  - Static Files   â”‚  /api   â”‚  - GCP í†µí•©              â”‚ â”‚
â”‚  â”‚                   â”‚         â”‚                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚                    â”‚
â”‚                                         â”‚ SQL                â”‚
â”‚                                         â–¼                    â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                         â”‚  GCP Cloud SQL           â”‚         â”‚
â”‚                         â”‚  (PostgreSQL 15)         â”‚         â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚            â”‚            â”‚
              â–¼            â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Cloud Storageâ”‚ â”‚GCP Auth  â”‚ â”‚ Vertex AI    â”‚
    â”‚ (ë°±ì—…/ë™ê¸°)  â”‚ â”‚(OAuth2)  â”‚ â”‚ (AI ê¸°ëŠ¥)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°°í¬ í™˜ê²½ (3ë‹¨ê³„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê°œë°œ í™˜ê²½     â”‚       â”‚ ìŠ¤í…Œì´ì§• í™˜ê²½ â”‚       â”‚ ìš´ì˜ í™˜ê²½     â”‚
â”‚ (ë¡œì»¬)       â”‚       â”‚ (Cloud Run)  â”‚       â”‚ (Cloud Run)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ docker-      â”‚  â†’    â”‚ ìë™ ë°°í¬    â”‚  â†’    â”‚ ìë™ ë°°í¬    â”‚
â”‚ compose.yml  â”‚       â”‚ (CI/CD)      â”‚       â”‚ (CI/CD)      â”‚
â”‚              â”‚       â”‚              â”‚       â”‚              â”‚
â”‚ localhost:   â”‚       â”‚ staging.     â”‚       â”‚ app.         â”‚
â”‚ 8000/3000    â”‚       â”‚ example.com  â”‚       â”‚ example.com  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì¸ì¦ ì‹œìŠ¤í…œ ì„¤ê³„

### 1. JWT ê¸°ë°˜ ì¸ì¦ í”Œë¡œìš°

```
ì‚¬ìš©ì ë¡œê·¸ì¸ ìš”ì²­
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. GCP OAuth 2.0 (Google Sign-In)      â”‚
â”‚     ë˜ëŠ”                                 â”‚
â”‚     2. ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ (ë‚´ë¶€ ì¸ì¦)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ì‚¬ìš©ì ì •ë³´ ì €ì¥ (DB)                â”‚
â”‚     - user_id (UUID)                     â”‚
â”‚     - email (unique)                     â”‚
â”‚     - name                               â”‚
â”‚     - role (admin, user)                â”‚
â”‚     - created_at                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. JWT í† í° ìƒì„±                        â”‚
â”‚     - Access Token (15ë¶„)                â”‚
â”‚     - Refresh Token (7ì¼)                â”‚
â”‚     - Secret: GCP Secret Manager         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. ì‘ë‹µ ë°˜í™˜                            â”‚
â”‚     - access_token                       â”‚
â”‚     - refresh_token                      â”‚
â”‚     - user (ID, email, name, role)       â”‚
â”‚     - expires_in (seconds)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
í´ë¼ì´ì–¸íŠ¸:
  - localStorageì— í† í° ì €ì¥
  - ëª¨ë“  ìš”ì²­ì— Authorization í—¤ë” í¬í•¨
  - Refresh Tokenìœ¼ë¡œ ìƒˆ Access Token íšë“
```

### 2. JWT í† í° êµ¬ì¡°

**Access Token (Bearer Token)**
```json
{
  "sub": "user-uuid-here",
  "email": "user@example.com",
  "name": "User Name",
  "role": "user",
  "iat": 1234567890,
  "exp": 1234569690,
  "iss": "mathesis-lab"
}
```

**Refresh Token**
```json
{
  "sub": "user-uuid-here",
  "type": "refresh",
  "iat": 1234567890,
  "exp": 1234654290,
  "iss": "mathesis-lab"
}
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¶”ê°€

**users í…Œì´ë¸”**
```sql
CREATE TABLE users (
  user_id VARCHAR(36) PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(255) NOT NULL,
  password_hash VARCHAR(255),  -- NULL if OAuth
  profile_picture_url TEXT,
  role VARCHAR(50) DEFAULT 'user',  -- admin, user
  is_active BOOLEAN DEFAULT true,
  last_login TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  deleted_at TIMESTAMP  -- soft delete
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role ON users(role);
```

**user_sessions í…Œì´ë¸”** (optional - í† í° ë¬´íš¨í™” ê´€ë¦¬)
```sql
CREATE TABLE user_sessions (
  session_id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(36) NOT NULL,
  refresh_token_hash VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  expires_at TIMESTAMP NOT NULL,
  revoked_at TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

**curriculum_permissions í…Œì´ë¸”** (ê³µìœ  ë° ì ‘ê·¼ ì œì–´)
```sql
CREATE TABLE curriculum_permissions (
  permission_id VARCHAR(36) PRIMARY KEY,
  curriculum_id VARCHAR(36) NOT NULL,
  user_id VARCHAR(36) NOT NULL,
  permission_type VARCHAR(50),  -- owner, editor, viewer
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (curriculum_id) REFERENCES curriculums(curriculum_id),
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  UNIQUE(curriculum_id, user_id)
);
```

### 4. ë°±ì—”ë“œ ì¸ì¦ êµ¬í˜„ í•­ëª©

**Backend íŒŒì¼ êµ¬ì¡°**
```
backend/app/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ jwt_handler.py        # JWT ìƒì„±/ê²€ì¦
â”‚   â”œâ”€â”€ password_handler.py   # ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
â”‚   â”œâ”€â”€ oauth_handler.py      # GCP OAuth2
â”‚   â””â”€â”€ permissions.py        # ê¶Œí•œ ê²€ì¦
â”œâ”€â”€ models/
â”‚   â””â”€â”€ user.py              # ì¶”ê°€: User ëª¨ë¸
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ auth.py              # ì¶”ê°€: ì¸ì¦ ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
â”‚   â””â”€â”€ user.py              # ì¶”ê°€: User ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth_service.py      # ì¶”ê°€: ì¸ì¦ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â””â”€â”€ user_service.py      # ì¶”ê°€: ì‚¬ìš©ì ê´€ë¦¬ ë¡œì§
â”œâ”€â”€ api/v1/
â”‚   â””â”€â”€ endpoints/
â”‚       â”œâ”€â”€ auth.py          # ì¶”ê°€: ì¸ì¦ ì—”ë“œí¬ì¸íŠ¸
â”‚       â””â”€â”€ users.py         # ì¶”ê°€: ì‚¬ìš©ì ê´€ë¦¬ ì—”ë“œí¬ì¸íŠ¸
â””â”€â”€ core/
    â”œâ”€â”€ config.py            # ì—…ë°ì´íŠ¸: JWT ì„¤ì •
    â””â”€â”€ dependencies.py      # ì¶”ê°€: ì¸ì¦ ì˜ì¡´ì„±
```

**ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸**
```
POST   /api/v1/auth/register          # íšŒì›ê°€ì… (ì´ë©”ì¼)
POST   /api/v1/auth/login             # ë¡œê·¸ì¸ (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸)
POST   /api/v1/auth/google-callback   # OAuth2 ì½œë°±
POST   /api/v1/auth/refresh           # í† í° ê°±ì‹ 
POST   /api/v1/auth/logout            # ë¡œê·¸ì•„ì›ƒ
GET    /api/v1/auth/me                # í˜„ì¬ ì‚¬ìš©ì ì •ë³´
GET    /api/v1/users/{user_id}        # ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
PUT    /api/v1/users/{user_id}        # ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •
```

### 5. í”„ë¡ íŠ¸ì—”ë“œ ì¸ì¦ êµ¬í˜„ í•­ëª©

**Frontend íŒŒì¼ êµ¬ì¡°**
```
MATHESIS-LAB_FRONT/
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx              # ì¶”ê°€: ì¸ì¦ ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useAuth.ts                   # ì¶”ê°€: ì¸ì¦ í›…
â”œâ”€â”€ services/
â”‚   â””â”€â”€ authService.ts               # ì¶”ê°€: ì¸ì¦ API í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Login.tsx                    # ì¶”ê°€: ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â”œâ”€â”€ Register.tsx                 # ì¶”ê°€: íšŒì›ê°€ì… í˜ì´ì§€
â”‚   â””â”€â”€ OAuthCallback.tsx            # ì¶”ê°€: OAuth ì½œë°± í˜ì´ì§€
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ProtectedRoute.tsx            # ì¶”ê°€: ë³´í˜¸ëœ ë¼ìš°íŠ¸
â””â”€â”€ App.tsx                           # ì—…ë°ì´íŠ¸: ì¸ì¦ ë¼ìš°íŒ…
```

**ì£¼ìš” ì»´í¬ë„ŒíŠ¸/ê¸°ëŠ¥**
- ë¡œê·¸ì¸ í˜ì´ì§€ (ì´ë©”ì¼, Google Sign-In ë²„íŠ¼)
- íšŒì›ê°€ì… í˜ì´ì§€
- ë³´í˜¸ëœ ë¼ìš°íŠ¸ (ì¸ì¦ í•„ìš”)
- í† í° ì €ì¥ ë° ê°±ì‹  ë¡œì§
- ì‚¬ìš©ì í”„ë¡œí•„ í˜ì´ì§€

---

## GCP í†µí•© ê³„íš

### 1. GCP ì„œë¹„ìŠ¤ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      GCP Project Setup               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Cloud Run                 â”‚  â”‚
â”‚  â”‚    - Backend ë°°í¬             â”‚  â”‚
â”‚  â”‚    - Frontend ë°°í¬            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. Cloud SQL                 â”‚  â”‚
â”‚  â”‚    - PostgreSQL 15           â”‚  â”‚
â”‚  â”‚    - Automated Backup        â”‚  â”‚
â”‚  â”‚    - Connection Pooling      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 3. Cloud Storage             â”‚  â”‚
â”‚  â”‚    - ë°±ì—… ì €ì¥               â”‚  â”‚
â”‚  â”‚    - ì‚¬ìš©ì íŒŒì¼             â”‚  â”‚
â”‚  â”‚    - ì •ì  íŒŒì¼ CDN (optional)â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4. Secret Manager            â”‚  â”‚
â”‚  â”‚    - JWT Secret              â”‚  â”‚
â”‚  â”‚    - DB ë¹„ë°€ë²ˆí˜¸             â”‚  â”‚
â”‚  â”‚    - API Keys                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5. Cloud Identity / IAM      â”‚  â”‚
â”‚  â”‚    - ì„œë¹„ìŠ¤ ê³„ì • ê´€ë¦¬         â”‚  â”‚
â”‚  â”‚    - ì—­í•  ë° ê¶Œí•œ             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 6. Cloud Logging (ì„ íƒ)      â”‚  â”‚
â”‚  â”‚    - êµ¬ì¡°í™”ëœ ë¡œê¹…            â”‚  â”‚
â”‚  â”‚    - ì—ëŸ¬ ì¶”ì                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 7. Vertex AI (ì„ íƒ)          â”‚  â”‚
â”‚  â”‚    - í…ìŠ¤íŠ¸ ìƒì„± API         â”‚  â”‚
â”‚  â”‚    - ì„ë² ë”© API              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ë°±ì—”ë“œ GCP í†µí•©

**í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ (requirements.txt ì¶”ê°€)**
```
google-cloud-sql-connector==1.10.1
google-cloud-secret-manager==2.19.0
google-cloud-storage==3.5.0
PyJWT==2.10.1
python-jose==3.3.0
passlib==1.7.4
```

**Backend íŒŒì¼ êµ¬ì¡°**
```
backend/app/
â”œâ”€â”€ integrations/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ gcp_secrets.py        # ì¶”ê°€: Secret Manager í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ gcp_storage.py        # ì¶”ê°€: Cloud Storage í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ gcp_auth.py           # ì¶”ê°€: GCP IAM í†µí•©
â”‚   â””â”€â”€ vertex_ai_client.py   # ì¶”ê°€: Vertex AI í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ db/
â”‚   â””â”€â”€ cloudsql.py           # ì¶”ê°€: Cloud SQL ì—°ê²°
â””â”€â”€ core/
    â””â”€â”€ config.py             # ì—…ë°ì´íŠ¸: GCP ì„¤ì •
```

**ì£¼ìš” ê¸°ëŠ¥**
- Cloud SQL ìë™ ì—°ê²° (Cloud SQL Connector)
- Secret Managerì—ì„œ ë¹„ë°€ ìë™ ë¡œë“œ
- Cloud Storageì— ë°±ì—… ì €ì¥/ë³µì›
- Vertex AI í…ìŠ¤íŠ¸ ìƒì„± API í˜¸ì¶œ
- êµ¬ì¡°í™”ëœ ë¡œê¹…

### 3. í”„ë¡ íŠ¸ì—”ë“œ GCP í†µí•©

**í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬**
```json
{
  "dependencies": {
    "@react-oauth/google": "^0.12.1"
  }
}
```

**Frontend í†µí•© í•­ëª©**
- Google Sign-In ë²„íŠ¼ ì¶”ê°€
- OAuth ì½œë°± ì²˜ë¦¬
- ì‚¬ìš©ì í”„ë¡œí•„ ì‚¬ì§„ í‘œì‹œ

### 4. ì¸ì¦ ë° ê¶Œí•œ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ì‚¬ìš©ì ë¡œê·¸ì¸ ìš”ì²­             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚  ë¡œê·¸ì¸ ë°©ì‹? â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚        â”‚        â”‚
      â–¼        â–¼        â–¼
   Gmail    ì´ë©”ì¼    ê¸°íƒ€
   OAuth    ë¹„ë°€ë²ˆí˜¸
      â”‚        â”‚        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ì‚¬ìš©ì ì •ë³´ ê²€ì¦    â”‚
    â”‚  (DB ì¡°íšŒ/ìƒì„±)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  JWT í† í° ìƒì„±      â”‚
    â”‚  (Secret Manager)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ì‘ë‹µ ë°˜í™˜ (í† í°)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë°°í¬ êµ¬ì¡°

### 1. ë¡œì»¬ ê°œë°œ í™˜ê²½

**docker-compose.yml**
```yaml
version: '3.8'

services:
  backend:
    build:
      context: .
      dockerfile: backend.Dockerfile
    environment:
      DATABASE_URL: postgresql://user:password@postgres:5432/mathesis_lab_dev
      JWT_SECRET: dev-secret-key-not-for-production
      ENVIRONMENT: development
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app/backend
    depends_on:
      - postgres

  frontend:
    build:
      context: MATHESIS-LAB_FRONT
      dockerfile: Dockerfile
      target: development
    environment:
      VITE_API_URL: http://localhost:8000/api/v1
    ports:
      - "3002:3002"
    volumes:
      - ./MATHESIS-LAB_FRONT:/app
    depends_on:
      - backend

  postgres:
    image: postgres:15
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: mathesis_lab_dev
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

### 2. Cloud Run ë°°í¬

**Backend Dockerfile**
```dockerfile
# Stage 1: Build
FROM python:3.11-slim as builder

WORKDIR /app

COPY backend/requirements.txt .
RUN pip install --user --no-cache-dir -r requirements.txt

# Stage 2: Runtime
FROM python:3.11-slim

WORKDIR /app

COPY --from=builder /root/.local /root/.local
COPY backend .

ENV PATH=/root/.local/bin:$PATH
ENV PYTHONUNBUFFERED=1

EXPOSE 8000

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**Frontend Dockerfile**
```dockerfile
# Stage 1: Build
FROM node:22-alpine as builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

# Stage 2: Serve
FROM node:22-alpine

WORKDIR /app

RUN npm install -g http-server

COPY --from=builder /app/dist ./dist
COPY nginx.conf /app/

EXPOSE 3000

CMD ["http-server", "dist", "-p", "3000", "-c-1"]
```

### 3. ë°°í¬ ìë™í™” (GitHub Actions)

**.github/workflows/deploy.yml**
```yaml
name: Deploy to Cloud Run

on:
  push:
    branches:
      - master
      - main
  workflow_dispatch:

env:
  PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
  REGION: asia-northeast1
  BACKEND_SERVICE: mathesis-lab-backend
  FRONTEND_SERVICE: mathesis-lab-frontend

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v1
        with:
          project_id: ${{ secrets.GCP_PROJECT_ID }}
          service_account_key: ${{ secrets.GCP_SA_KEY }}

      - name: Configure Docker
        run: |
          gcloud auth configure-docker

      - name: Build and push backend
        run: |
          docker build -f backend.Dockerfile -t gcr.io/$PROJECT_ID/$BACKEND_SERVICE:${{ github.sha }} .
          docker push gcr.io/$PROJECT_ID/$BACKEND_SERVICE:${{ github.sha }}

      - name: Deploy to Cloud Run
        run: |
          gcloud run deploy $BACKEND_SERVICE \
            --image gcr.io/$PROJECT_ID/$BACKEND_SERVICE:${{ github.sha }} \
            --region $REGION \
            --platform managed \
            --allow-unauthenticated \
            --set-env-vars DATABASE_URL=${{ secrets.CLOUD_SQL_CONNECTION_STRING }},\
JWT_SECRET=${{ secrets.JWT_SECRET }}

  deploy-frontend:
    needs: deploy-backend
    runs-on: ubuntu-latest
    steps:
      # ìœ ì‚¬í•œ ë°°í¬ í”„ë¡œì„¸ìŠ¤
```

---

## êµ¬í˜„ ë¡œë“œë§µ

### Phase 1: ê¸°ì´ˆ êµ¬ì¶• (1ì£¼ì¼)
- [ ] JWT ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„
- [ ] ì‚¬ìš©ì ëª¨ë¸ ë° ìŠ¤í‚¤ë§ˆ ì¶”ê°€
- [ ] ì¸ì¦ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ (register, login, refresh)
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ë¡œê·¸ì¸/íšŒì›ê°€ì… í˜ì´ì§€
- [ ] ë³´í˜¸ëœ ë¼ìš°íŠ¸ êµ¬í˜„
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

### Phase 2: GCP ì—°ë™ (1ì£¼ì¼)
- [ ] GCP í”„ë¡œì íŠ¸ ì„¤ì •
- [ ] Cloud SQL ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
- [ ] Cloud Storage ì„¤ì •
- [ ] Secret Manager ì„¤ì •
- [ ] ë¡œì»¬ docker-compose êµ¬ì„±
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

### Phase 3: ì»¨í…Œì´ë„ˆí™” (3ì¼)
- [ ] Backend Dockerfile ì‘ì„±
- [ ] Frontend Dockerfile ì‘ì„±
- [ ] docker-compose ì™„ì„±
- [ ] ë¡œì»¬ í…ŒìŠ¤íŠ¸

### Phase 4: ë°°í¬ ìë™í™” (3ì¼)
- [ ] GitHub Actions ì›Œí¬í”Œë¡œìš° ì„¤ì •
- [ ] Cloud Run ë°°í¬ êµ¬ì„±
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] SSL/TLS ì¸ì¦ì„œ

### Phase 5: ëª¨í¬ì—… í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (3ì¼)
- [ ] ì™„ì „í•œ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ ì‘ì„±
- [ ] E2E í…ŒìŠ¤íŠ¸ ì¶”ê°€
- [ ] ë³´ì•ˆ ê²€ì‚¬
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ìµœì¢… í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ìƒì„±

### Phase 6: ìš´ì˜ ì¤€ë¹„ (2ì¼)
- [ ] ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì„¤ì •
- [ ] ì¬í•´ ë³µêµ¬ ê³„íš
- [ ] ë¬¸ì„œ ì‘ì„±
- [ ] ë°°í¬ ê°€ì´ë“œ ì‘ì„±

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì¸ì¦ ë³´ì•ˆ

```
âœ“ JWT í† í° ì„œëª… (RS256 ê¶Œì¥)
âœ“ ì•¡ì„¸ìŠ¤ í† í° ë§Œë£Œ (15ë¶„)
âœ“ ë¦¬í”„ë ˆì‹œ í† í° ë§Œë£Œ (7ì¼)
âœ“ HTTPS only ì¿ í‚¤
âœ“ CORS í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
âœ“ Rate limiting (ë¡œê·¸ì¸ ì‹œë„)
âœ“ ë¹„ë°€ë²ˆí˜¸ í•´ì‹± (bcrypt)
âœ“ ë¹„ë°€ ì €ì¥ (Secret Manager)
```

### 2. API ë³´ì•ˆ

```
âœ“ JWT ê²€ì¦ ë¯¸ë“¤ì›¨ì–´
âœ“ CORS ì„¤ì •
âœ“ Rate limiting
âœ“ SQL injection ë°©ì§€ (ORM ì‚¬ìš©)
âœ“ XSS ë°©ì§€ (React ìë™ escape)
âœ“ CSRF ë³´í˜¸
âœ“ ì…ë ¥ ê²€ì¦ (Pydantic)
```

### 3. ë°ì´í„° ë³´ì•ˆ

```
âœ“ ì „ì†¡ ì¤‘ ì•”í˜¸í™” (HTTPS)
âœ“ ì €ì¥ ì¤‘ ì•”í˜¸í™” (Cloud SQL SSL)
âœ“ ì ‘ê·¼ ì œì–´ (IAM)
âœ“ ê°ì‹œ ë¡œê¹… (Cloud Logging)
âœ“ ì •ê¸° ë°±ì—…
âœ“ ë¯¼ê°ì •ë³´ ì•”í˜¸í™”
```

### 4. ì¸í”„ë¼ ë³´ì•ˆ

```
âœ“ VPC ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬
âœ“ ë°©í™”ë²½ ê·œì¹™
âœ“ IAM ìµœì†Œ ê¶Œí•œ ì›ì¹™
âœ“ ì„œë¹„ìŠ¤ ê³„ì • ê²©ë¦¬
âœ“ ê°ì‚¬ ë¡œê¹…
âœ“ DDoS ë°©ì–´
```

---

## ë‹¤ìŒ ë‹¨ê³„

1. **ì´ ê³„íš ê²€í† **: ì•„í‚¤í…ì²˜, ê¸°ìˆ  ìŠ¤íƒ, ì¼ì • í™•ì¸
2. **GCP í”„ë¡œì íŠ¸ ì¤€ë¹„**: í”„ë¡œì íŠ¸ ID, ì²­êµ¬ ê³„ì • ì„¤ì • ì¤€ë¹„
3. **íŒ€ í• ë‹¹**: ê° êµ¬ì„± ìš”ì†Œë³„ ë‹´ë‹¹ì ì§€ì •
4. **ìƒì„¸ êµ¬í˜„ ê³„íš**: ê° Phaseë³„ êµ¬ì²´ì ì¸ ì‘ì—… í•­ëª© ìˆ˜ë¦½
5. **í…ŒìŠ¤íŠ¸ ì „ëµ**: ê° êµ¬ì„± ìš”ì†Œë³„ í…ŒìŠ¤íŠ¸ ê³„íš ìˆ˜ë¦½

---

**ë¬¸ì„œ ì‘ì„± ì¼ì‹œ**: 2025-11-16
**ìµœì¢… ê²€í†  ì˜ˆì •**: êµ¬í˜„ ì‹œì‘ ì „
